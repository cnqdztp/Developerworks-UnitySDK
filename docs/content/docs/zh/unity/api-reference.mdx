---
title: API 参考
description: Unity SDK 的完整 API 文档
---

# API 参考

Developerworks Unity SDK 的完整参考文档。

## DeveloperworksSDK

提供所有功能访问的主 SDK 类。

### 单例实例

```csharp
DeveloperworksSDK.Instance
```

初始化后访问 SDK 单例实例。

### 初始化

#### InitializeDevelopment

```csharp
async UniTask<bool> InitializeDevelopment(string developerToken)
```

使用开发者令牌在开发模式下初始化 SDK。

**参数：**
- `developerToken` (string)：来自 Developerworks 平台的开发者令牌

**返回值：** 初始化成功返回 `true`，否则返回 `false`

**警告：** 此模式会花钱！仅用于开发和测试。

#### InitializeProduction

```csharp
async UniTask<bool> InitializeProduction()
```

在生产模式下使用玩家身份验证初始化 SDK。

**返回值：** 初始化成功返回 `true`，否则返回 `false`

**注意：** 玩家必须通过 UI 登录。此模式免费。

### 属性

#### Chat

```csharp
ChatClient Chat { get; }
```

访问用于 AI 对话的聊天客户端。

#### Image

```csharp
ImageGenerationClient Image { get; }
```

访问图像生成客户端。

#### Audio

```csharp
AudioTranscriptionClient Audio { get; }
```

访问音频转录客户端。

#### Player

```csharp
PlayerClient Player { get; }
```

访问玩家管理客户端。

## ChatClient

处理 AI 聊天和文本生成。

### SendMessageAsync

```csharp
async UniTask<APIResponse<ChatResponse>> SendMessageAsync(
    string userMessage,
    string systemPrompt = null,
    string modelName = null,
    List<ChatMessage> conversationHistory = null
)
```

向 AI 发送聊天消息。

**参数：**
- `userMessage` (string)：用户的消息
- `systemPrompt` (string, 可选)：AI 的系统指令
- `modelName` (string, 可选)：要使用的 AI 模型（默认：gpt-4o-mini）
- `conversationHistory` (List<ChatMessage>, 可选)：之前的对话上下文

**返回值：** 包含 AI 回复的 `APIResponse<ChatResponse>`

**示例：**
```csharp
var result = await chatClient.SendMessageAsync(
    "讲个笑话",
    modelName: "gpt-4o-mini"
);

if (result.success)
{
    Debug.Log(result.data.message);
}
```

## NPCClient

具有自动历史管理的 NPC 对话简化界面。

### CreateNPC

```csharp
NPCClient CreateNPC(string npcId, string systemPrompt, string modelName = null)
```

创建新的 NPC 客户端。

**参数：**
- `npcId` (string)：此 NPC 的唯一标识符
- `systemPrompt` (string)：NPC 的个性和行为指令
- `modelName` (string, 可选)：要使用的 AI 模型

**示例：**
```csharp
var npc = DeveloperworksSDK.Instance.CreateNPC(
    "merchant",
    "你是一个友好的商人，喜欢讨价还价。"
);
```

### SendMessageAsync

```csharp
async UniTask<APIResponse<ChatResponse>> SendMessageAsync(string userMessage)
```

向 NPC 发送消息。对话历史会自动管理。

## ImageGenerationClient

生成 AI 图像。

### GenerateImageAsync

```csharp
async UniTask<APIResponse<ImageResponse>> GenerateImageAsync(
    string prompt,
    string modelName = null,
    int width = 1024,
    int height = 1024
)
```

从文本提示生成图像。

**参数：**
- `prompt` (string)：要生成的图像描述
- `modelName` (string, 可选)：要使用的图像模型
- `width` (int, 可选)：图像宽度（默认：1024）
- `height` (int, 可选)：图像高度（默认：1024）

**返回值：** 包含生成的图像纹理的 `APIResponse<ImageResponse>`

## AudioTranscriptionClient

将语音转换为文本。

### TranscribeAudioAsync

```csharp
async UniTask<APIResponse<TranscriptionResponse>> TranscribeAudioAsync(
    byte[] audioData,
    string language = null
)
```

将音频转录为文本。

**参数：**
- `audioData` (byte[])：WAV 格式的音频数据
- `language` (string, 可选)：语言代码（例如："en"、"zh"）

## MicrophoneRecorder

具有语音活动检测的录音功能。

### StartRecording

```csharp
void StartRecording(
    float silenceDuration = 2f,
    float minRecordingDuration = 1f,
    float maxRecordingDuration = 30f
)
```

开始录音，静音时自动停止。

**参数：**
- `silenceDuration` (float)：停止前的静音秒数
- `minRecordingDuration` (float)：最小录音长度
- `maxRecordingDuration` (float)：最大录音长度

### 事件

```csharp
event Action<byte[]> OnRecordingComplete
event Action<string> OnRecordingError
```

## PlayerClient

管理玩家信息和身份验证。

### GetPlayerInfoAsync

```csharp
async UniTask<APIResponse<PlayerInfo>> GetPlayerInfoAsync()
```

获取当前玩家的信息，包括点数余额。

## 响应类型

### APIResponse<T>

```csharp
public class APIResponse<T>
{
    public bool success;
    public T data;
    public string error;
}
```

### ChatResponse

```csharp
public class ChatResponse
{
    public string message;
    public int usedCredits;
    public string model;
}
```

### ImageResponse

```csharp
public class ImageResponse
{
    public Texture2D texture;
    public int usedCredits;
    public string model;
}
```

### TranscriptionResponse

```csharp
public class TranscriptionResponse
{
    public string text;
    public int usedCredits;
}
```

### PlayerInfo

```csharp
public class PlayerInfo
{
    public string playerId;
    public int credits;
    public string username;
}
```
